{"version":3,"sources":["../src/supabase/server.ts","../src/stripe/server.ts","../src/env/server.ts","../src/billing/plans.ts","../src/billing/actions.ts","../src/billing/BillingForm.tsx","../src/stripe/client.ts","../src/env/client.ts","../src/ui/button.tsx","../src/ui/cn.ts","../src/ui/card.tsx","../src/webhook/stripe.ts","../src/supabase/admin.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport type { SetAllCookies } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\n\nexport const createClient = async () => {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll: () => cookieStore.getAll(),\n        setAll: (cookiesToSet: Parameters<SetAllCookies>[0]) => {\n          cookiesToSet.forEach(({ name, value, options }) =>\n            cookieStore.set(name, value, options)\n          )\n        }\n      }\n    }\n  )\n}\n","import Stripe from 'stripe'\nimport { env } from '../env/server'\n\nexport const stripe = new Stripe(env.STRIPE_SECRET_KEY, {\n  apiVersion: '2024-06-20'\n})\n","import 'server-only'\nimport { z } from 'zod'\n\nconst envSchema = z.object({\n  NEXT_PUBLIC_SUPABASE_URL: z.string().url(),\n  NEXT_PUBLIC_SUPABASE_ANON_KEY: z.string().min(1),\n  SUPABASE_SERVICE_ROLE_KEY: z.string().min(1).optional(),\n  NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY: z.string().min(1),\n  STRIPE_SECRET_KEY: z.string().min(1),\n  STRIPE_WEBHOOK_SECRET: z.string().min(1),\n  STRIPE_PRICE_CONTENT_PACK: z.string().min(1),\n  STRIPE_PRICE_PRO_MONTHLY: z.string().min(1),\n  STRIPE_PRICE_PRO_ANNUAL: z.string().min(1),\n  NODE_ENV: z.enum(['development', 'production', 'test']).default('development')\n})\n\nexport const env = envSchema.parse(process.env)\n","import { env } from '../env/server'\nimport { stripe } from '../stripe/server'\n\nexport type BillingPlan = {\n  id: 'content_pack' | 'pro_monthly' | 'pro_annual'\n  name: string\n  description: string\n  priceId: string\n  amount: number\n  currency: 'gbp'\n  interval: 'one_time' | 'month' | 'year'\n  flags: string[]\n}\n\nexport const billingPlans: BillingPlan[] = [\n  {\n    id: 'content_pack',\n    name: 'Content Pack',\n    description: 'One-time access to premium content.',\n    priceId: env.STRIPE_PRICE_CONTENT_PACK,\n    amount: 1500,\n    currency: 'gbp',\n    interval: 'one_time',\n    flags: ['content_pack']\n  },\n  {\n    id: 'pro_monthly',\n    name: 'Pro Monthly',\n    description: 'Monthly subscription with downloads.',\n    priceId: env.STRIPE_PRICE_PRO_MONTHLY,\n    amount: 1200,\n    currency: 'gbp',\n    interval: 'month',\n    flags: ['pro_content', 'download_access']\n  },\n  {\n    id: 'pro_annual',\n    name: 'Pro Annual',\n    description: 'Annual subscription with support.',\n    priceId: env.STRIPE_PRICE_PRO_ANNUAL,\n    amount: 12000,\n    currency: 'gbp',\n    interval: 'year',\n    flags: ['pro_content', 'download_access', 'priority_support']\n  }\n]\n\nexport const getBillingPlansWithStripePricing = async () => {\n  'use server'\n  const plans = await Promise.all(\n    billingPlans.map(async (plan) => {\n      try {\n        const stripePrice = await stripe.prices.retrieve(plan.priceId)\n        if (typeof stripePrice.unit_amount === 'number') {\n          return {\n            ...plan,\n            amount: stripePrice.unit_amount\n          }\n        }\n      } catch {\n        return plan\n      }\n\n      return plan\n    })\n  )\n\n  return plans\n}\n\nexport const getFlagsForPriceIds = (priceIds: string[]) => {\n  const flags = new Set<string>()\n\n  billingPlans.forEach((plan) => {\n    if (priceIds.includes(plan.priceId)) {\n      plan.flags.forEach((flag) => flags.add(flag))\n    }\n  })\n\n  return Array.from(flags)\n}\n\nexport const subscriptionFlagSet = new Set(\n  billingPlans\n    .filter((plan) => plan.interval !== 'one_time')\n    .flatMap((plan) => plan.flags)\n)\n","import { createClient } from '../supabase/server'\nimport { stripe } from '../stripe/server'\nimport { billingPlans } from './plans'\n\nconst getPlanByPriceId = (priceId: string) =>\n  billingPlans.find((plan) => plan.priceId === priceId)\n\nconst ensureStripeCustomer = async (userId: string, email?: string | null) => {\n  const supabase = await createClient()\n\n  const { data: profile, error } = await supabase\n    .from('profiles')\n    .select('stripe_customer_id')\n    .eq('id', userId)\n    .single()\n\n  if (error) {\n    throw error\n  }\n\n  if (profile?.stripe_customer_id) {\n    return profile.stripe_customer_id\n  }\n\n  const customer = await stripe.customers.create({\n    email: email ?? undefined,\n    metadata: {\n      supabase_user_id: userId\n    }\n  })\n\n  const { error: updateError } = await supabase\n    .from('profiles')\n    .update({ stripe_customer_id: customer.id })\n    .eq('id', userId)\n\n  if (updateError) {\n    throw updateError\n  }\n\n  return customer.id\n}\n\nexport async function createPaymentIntent(priceId: string) {\n  'use server'\n  const supabase = await createClient()\n  const { data: userData, error: userError } = await supabase.auth.getUser()\n\n  if (userError || !userData?.user) {\n    return { error: 'Not authenticated.' }\n  }\n\n  const plan = getPlanByPriceId(priceId)\n  if (!plan || plan.interval !== 'one_time') {\n    return { error: 'Invalid price selection.' }\n  }\n\n  const customerId = await ensureStripeCustomer(\n    userData.user.id,\n    userData.user.email\n  )\n\n  const stripePrice = await stripe.prices.retrieve(priceId)\n  if (\n    !stripePrice.unit_amount ||\n    stripePrice.currency !== plan.currency ||\n    stripePrice.type !== 'one_time'\n  ) {\n    return { error: 'Price configuration error.' }\n  }\n\n  const paymentIntent = await stripe.paymentIntents.create({\n    amount: stripePrice.unit_amount,\n    currency: stripePrice.currency,\n    customer: customerId,\n    automatic_payment_methods: { enabled: true },\n    metadata: {\n      price_id: priceId,\n      supabase_user_id: userData.user.id\n    }\n  })\n\n  return { clientSecret: paymentIntent.client_secret }\n}\n\nexport async function createSubscription(priceId: string) {\n  'use server'\n  const supabase = await createClient()\n  const { data: userData, error: userError } = await supabase.auth.getUser()\n\n  if (userError || !userData?.user) {\n    return { error: 'Not authenticated.' }\n  }\n\n  const plan = getPlanByPriceId(priceId)\n  if (!plan || plan.interval === 'one_time') {\n    return { error: 'Invalid price selection.' }\n  }\n\n  const customerId = await ensureStripeCustomer(\n    userData.user.id,\n    userData.user.email\n  )\n\n  const subscription = await stripe.subscriptions.create({\n    customer: customerId,\n    items: [{ price: priceId }],\n    payment_behavior: 'default_incomplete',\n    payment_settings: { save_default_payment_method: 'on_subscription' },\n    expand: ['latest_invoice.payment_intent'],\n    metadata: {\n      price_id: priceId,\n      supabase_user_id: userData.user.id\n    }\n  })\n\n  if (!subscription.latest_invoice || typeof subscription.latest_invoice === 'string') {\n    return { error: 'Subscription payment could not be initialized.' }\n  }\n\n  const paymentIntent = subscription.latest_invoice.payment_intent\n  if (!paymentIntent || typeof paymentIntent === 'string') {\n    return { error: 'Subscription payment could not be initialized.' }\n  }\n\n  return {\n    clientSecret: paymentIntent.client_secret,\n    subscriptionId: subscription.id\n  }\n}\n\nexport async function getBillingProfile() {\n  'use server'\n  const supabase = await createClient()\n  const { data: userData, error: userError } = await supabase.auth.getUser()\n\n  if (userError || !userData?.user) {\n    return { error: 'Not authenticated.' }\n  }\n\n  const { data: profile, error } = await supabase\n    .from('profiles')\n    .select(\n      'stripe_subscription_status, stripe_current_period_end, feature_flags'\n    )\n    .eq('id', userData.user.id)\n    .single()\n\n  if (error) {\n    return { error: error.message }\n  }\n\n  return { profile }\n}\n","'use client'\n\nimport { useMemo, useState, useTransition } from 'react'\nimport type { FormEvent } from 'react'\nimport { Elements, PaymentElement, useElements, useStripe } from '@stripe/react-stripe-js'\nimport type { StripePaymentElementOptions } from '@stripe/stripe-js'\nimport { stripePromise } from '../stripe/client'\nimport { Button } from '../ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../ui/card'\n\nexport type BillingPlan = {\n  id: string\n  name: string\n  description: string\n  priceId: string\n  amount: number\n  currency: 'gbp'\n  interval: 'one_time' | 'month' | 'year'\n  flags: string[]\n}\n\ntype BillingProfile = {\n  stripe_subscription_status: string | null\n  stripe_current_period_end: string | null\n  feature_flags: unknown\n}\n\ntype BillingActions = {\n  createPaymentIntent: (priceId: string) => Promise<{ clientSecret?: string | null; error?: string }>\n  createSubscription: (priceId: string) => Promise<{ clientSecret?: string | null; error?: string }>\n}\n\ntype BillingFormProps = {\n  plans: BillingPlan[]\n  profile: BillingProfile | null\n  actions: BillingActions\n}\n\ntype PaymentFormProps = {\n  onClose: () => void\n  paymentElementOptions: StripePaymentElementOptions\n}\n\nconst PaymentForm = ({ onClose, paymentElementOptions }: PaymentFormProps) => {\n  const stripe = useStripe()\n  const elements = useElements()\n  const [message, setMessage] = useState<string | null>(null)\n  const [isSubmitting, setIsSubmitting] = useState(false)\n\n  const handleSubmit = async (event: FormEvent<HTMLFormElement>) => {\n    event.preventDefault()\n    if (!stripe || !elements) return\n\n    setIsSubmitting(true)\n    setMessage(null)\n\n    const result = await stripe.confirmPayment({\n      elements,\n      confirmParams: { return_url: `${window.location.origin}/dashboard/billing` },\n      redirect: 'if_required'\n    })\n\n    if (result.error) {\n      setMessage(result.error.message ?? 'Payment failed.')\n    } else {\n      setMessage('Payment submitted. Updates may take a moment to appear.')\n      onClose()\n    }\n\n    setIsSubmitting(false)\n  }\n\n  return (\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\n        <PaymentElement options={paymentElementOptions} />\n        {message ? <p className=\"text-sm text-muted-foreground\">{message}</p> : null}\n        <Button type=\"submit\" disabled={!stripe || isSubmitting}>\n          {isSubmitting ? 'Processing...' : 'Confirm payment'}\n        </Button>\n      </form>\n  )\n}\n\nexport const BillingForm = ({ plans, profile, actions }: BillingFormProps) => {\n  const [clientSecret, setClientSecret] = useState<string | null>(null)\n  const [selectedPlan, setSelectedPlan] = useState<BillingPlan | null>(null)\n  const [error, setError] = useState<string | null>(null)\n  const [isPending, startTransition] = useTransition()\n\n  const formatter = useMemo(\n      () => new Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP' }),\n      []\n  )\n\n  const featureFlags = Array.isArray(profile?.feature_flags)\n      ? (profile?.feature_flags as string[])\n      : []\n\n  const paymentElementOptions: StripePaymentElementOptions = { layout: 'tabs' }\n\n  const isPlanActive = (plan: BillingPlan) => {\n    if (plan.interval === 'one_time') {\n      return plan.flags.some(flag => featureFlags.includes(flag))\n    }\n    return plan.flags.some(flag => featureFlags.includes(flag)) && \n           profile?.stripe_subscription_status === 'active'\n  }\n\n  const isSubscriptionActive = (plan: BillingPlan) => {\n    return plan.interval !== 'one_time' && \n           plan.flags.some(flag => featureFlags.includes(flag)) &&\n           profile?.stripe_subscription_status === 'active'\n  }\n\n  const handleSelectPlan = (plan: BillingPlan) => {\n    setError(null)\n    setSelectedPlan(plan)\n    setClientSecret(null)\n\n    startTransition(async () => {\n      const response =\n          plan.interval === 'one_time'\n              ? await actions.createPaymentIntent(plan.priceId)\n              : await actions.createSubscription(plan.priceId)\n\n      if (response?.error) {\n        setError(response.error)\n        return\n      }\n\n      setClientSecret(response?.clientSecret ?? null)\n    })\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle>Your access</CardTitle>\n          <CardDescription>\n            Subscription status: {profile?.stripe_subscription_status ?? 'none'}\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-2 text-sm\">\n          <p>\n            Current flags:{' '}\n            {featureFlags.length ? featureFlags.join(', ') : 'none'}\n          </p>\n          {profile?.stripe_current_period_end ? (\n            <p>Access ends: {new Date(profile.stripe_current_period_end).toLocaleDateString()}</p>\n          ) : null}\n        </CardContent>\n      </Card>\n\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        {plans.map((plan) => {\n          const isActive = isPlanActive(plan)\n          const isActiveSubscription = isSubscriptionActive(plan)\n          \n          return (\n            <Card key={plan.id} className={isActive ? 'border-primary' : ''}>\n              <CardHeader>\n                <div className=\"flex items-start justify-between\">\n                  <div>\n                    <CardTitle>{plan.name}</CardTitle>\n                    <CardDescription>{plan.description}</CardDescription>\n                  </div>\n                  {isActiveSubscription && (\n                    <span className=\"rounded-md bg-primary px-2 py-1 text-xs font-medium text-primary-foreground\">\n                      Current Plan\n                    </span>\n                  )}\n                  {isActive && plan.interval === 'one_time' && (\n                    <span className=\"rounded-md bg-secondary px-2 py-1 text-xs font-medium\">\n                      Owned\n                    </span>\n                  )}\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <p className=\"text-2xl font-semibold\">\n                  {formatter.format(plan.amount / 100)}\n                  {plan.interval === 'month' ? '/mo' : plan.interval === 'year' ? '/yr' : ''}\n                </p>\n                <p className=\"text-xs text-muted-foreground\">\n                  Flags: {plan.flags.join(', ')}\n                </p>\n                {isActiveSubscription && profile?.stripe_current_period_end && (\n                  <p className=\"text-xs text-muted-foreground\">\n                    Renews: {new Date(profile.stripe_current_period_end).toLocaleDateString()}\n                  </p>\n                )}\n                <Button\n                  onClick={() => handleSelectPlan(plan)}\n                  disabled={isPending || isActiveSubscription}\n                  className=\"w-full\"\n                  variant={isActiveSubscription ? 'secondary' : 'default'}\n                >\n                  {isActiveSubscription \n                    ? 'Manage Subscription' \n                    : plan.interval === 'one_time' \n                      ? 'Buy now' \n                      : 'Subscribe'}\n                </Button>\n              </CardContent>\n            </Card>\n          )\n        })}\n      </div>\n\n      {error ? <p className=\"text-sm text-destructive\">{error}</p> : null}\n\n      {clientSecret && selectedPlan ? (\n        <Card>\n          <CardHeader>\n            <CardTitle>Complete payment for {selectedPlan.name}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Elements stripe={stripePromise} options={{ clientSecret }}>\n              <PaymentForm\n                onClose={() => setClientSecret(null)}\n                paymentElementOptions={paymentElementOptions}\n              />\n            </Elements>\n          </CardContent>\n        </Card>\n      ) : null}\n    </div>\n  )\n}\n","import { loadStripe } from '@stripe/stripe-js'\nimport { clientEnv } from '../env/client'\n\nexport const stripePromise = loadStripe(clientEnv.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY)\n","import { z } from 'zod'\n\nconst clientEnvSchema = z.object({\n  NEXT_PUBLIC_SUPABASE_URL: z.string().url(),\n  NEXT_PUBLIC_SUPABASE_ANON_KEY: z.string().min(1),\n  NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY: z.string().min(1)\n})\n\nexport const clientEnv = clientEnvSchema.parse({\n  NEXT_PUBLIC_SUPABASE_URL: process.env.NEXT_PUBLIC_SUPABASE_URL,\n  NEXT_PUBLIC_SUPABASE_ANON_KEY: process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\n  NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY: process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY\n})\n","import * as React from 'react'\nimport { Slot } from '@radix-ui/react-slot'\nimport { cva, type VariantProps } from 'class-variance-authority'\n\nimport { cn } from './cn'\n\nconst buttonVariants = cva(\n  'inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all cursor-pointer disabled:pointer-events-none disabled:opacity-50 disabled:cursor-not-allowed [&_svg]:pointer-events-none [&_svg:not([class*=\"size-\"])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive',\n  {\n    variants: {\n      variant: {\n        default: 'bg-primary text-primary-foreground shadow-xs hover:bg-primary/90',\n        destructive:\n          'bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',\n        outline:\n          'border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50',\n        secondary: 'bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80',\n        ghost: 'hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50',\n        link: 'text-primary underline-offset-4 hover:underline'\n      },\n      size: {\n        default: 'h-9 px-4 py-2 has-[>svg]:px-3',\n        sm: 'h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5',\n        lg: 'h-10 rounded-md px-6 has-[>svg]:px-4',\n        icon: 'size-9'\n      }\n    },\n    defaultVariants: {\n      variant: 'default',\n      size: 'default'\n    }\n  }\n)\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<'button'> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }) {\n  const Comp = asChild ? Slot : 'button'\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nexport { Button, buttonVariants }\n","import { type ClassValue, clsx } from 'clsx'\nimport { twMerge } from 'tailwind-merge'\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","import * as React from 'react'\n\nimport { cn } from './cn'\n\nfunction Card({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        'bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm',\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        '@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6',\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn('leading-none font-semibold', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn('text-muted-foreground text-sm', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        'col-start-2 row-span-2 row-start-1 self-start justify-self-end',\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn('px-6', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn('flex items-center px-6 [.border-t]:pt-6', className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent\n}\n","import Stripe from 'stripe'\nimport { headers } from 'next/headers'\nimport { stripe } from '../stripe/server'\nimport { createAdminClient } from '../supabase/admin'\nimport { getFlagsForPriceIds, subscriptionFlagSet } from '../billing/plans'\nimport { env } from '../env/server'\n\nconst toIsoString = (unixSeconds: number | null) => {\n  if (!unixSeconds) return null\n  return new Date(unixSeconds * 1000).toISOString()\n}\n\nconst getProfileFlagsForCustomer = async (stripeCustomerId: string) => {\n  const supabase = createAdminClient()\n\n  const { data, error } = await supabase\n    .from('profiles')\n    .select('feature_flags')\n    .eq('stripe_customer_id', stripeCustomerId)\n    .single()\n\n  if (error) {\n    throw error\n  }\n\n  return Array.isArray(data?.feature_flags) ? (data.feature_flags as string[]) : []\n}\n\nconst updateProfileForCustomer = async (\n  stripeCustomerId: string,\n  updates: Record<string, unknown>\n) => {\n  const supabase = createAdminClient()\n\n  const { error } = await supabase\n    .from('profiles')\n    .update(updates)\n    .eq('stripe_customer_id', stripeCustomerId)\n\n  if (error) {\n    throw error\n  }\n}\n\nconst handlePaymentIntentSucceeded = async (paymentIntent: Stripe.PaymentIntent) => {\n  const priceId = paymentIntent.metadata?.price_id\n  if (!priceId || !paymentIntent.customer) return\n\n  const flags = getFlagsForPriceIds([priceId])\n  const currentFlags = await getProfileFlagsForCustomer(String(paymentIntent.customer))\n  const nextFlags = Array.from(new Set([...currentFlags, ...flags]))\n\n  await updateProfileForCustomer(String(paymentIntent.customer), {\n    feature_flags: nextFlags\n  })\n}\n\nconst handleSubscriptionUpdate = async (subscription: Stripe.Subscription) => {\n  if (!subscription.customer) return\n\n  const priceIds = subscription.items.data\n    .map((item) => item.price?.id)\n    .filter((id): id is string => Boolean(id))\n\n  const flags = getFlagsForPriceIds(priceIds)\n  const currentFlags = await getProfileFlagsForCustomer(String(subscription.customer))\n  const retainedFlags = currentFlags.filter((flag) => !subscriptionFlagSet.has(flag))\n  const nextFlags = Array.from(new Set([...retainedFlags, ...flags]))\n\n  await updateProfileForCustomer(String(subscription.customer), {\n    stripe_subscription_id: subscription.id,\n    stripe_subscription_status: subscription.status,\n    stripe_current_period_end: toIsoString(subscription.current_period_end),\n    feature_flags: nextFlags\n  })\n}\n\nconst handleSubscriptionDeleted = async (subscription: Stripe.Subscription) => {\n  if (!subscription.customer) return\n\n  const currentFlags = await getProfileFlagsForCustomer(String(subscription.customer))\n  const retainedFlags = currentFlags.filter((flag) => !subscriptionFlagSet.has(flag))\n\n  await updateProfileForCustomer(String(subscription.customer), {\n    stripe_subscription_id: subscription.id,\n    stripe_subscription_status: subscription.status,\n    stripe_current_period_end: toIsoString(subscription.current_period_end),\n    feature_flags: retainedFlags\n  })\n}\n\nconst handleInvoicePaid = async (invoice: Stripe.Invoice) => {\n  if (!invoice.subscription) return\n\n  const subscription = await stripe.subscriptions.retrieve(\n    typeof invoice.subscription === 'string'\n      ? invoice.subscription\n      : invoice.subscription.id\n  )\n\n  await handleSubscriptionUpdate(subscription)\n}\n\nexport async function POST(request: Request) {\n  const body = await request.text()\n  const headerStore = await headers()\n  const signature = headerStore.get('stripe-signature')\n\n  if (!signature) {\n    return new Response('Missing stripe signature', { status: 400 })\n  }\n\n  let event: Stripe.Event\n  try {\n    event = stripe.webhooks.constructEvent(\n      body,\n      signature,\n      env.STRIPE_WEBHOOK_SECRET\n    )\n  } catch (error) {\n    const message =\n      error instanceof Error ? error.message : 'Webhook signature failed.'\n    return new Response(message, { status: 400 })\n  }\n\n  try {\n    switch (event.type) {\n      case 'payment_intent.succeeded':\n        await handlePaymentIntentSucceeded(event.data.object as Stripe.PaymentIntent)\n        break\n      case 'invoice.paid':\n        await handleInvoicePaid(event.data.object as Stripe.Invoice)\n        break\n      case 'customer.subscription.created':\n      case 'customer.subscription.updated':\n        await handleSubscriptionUpdate(event.data.object as Stripe.Subscription)\n        break\n      case 'customer.subscription.deleted':\n        await handleSubscriptionDeleted(event.data.object as Stripe.Subscription)\n        break\n      default:\n        break\n    }\n  } catch (error) {\n    const message = error instanceof Error ? error.message : 'Webhook error.'\n    return new Response(message, { status: 500 })\n  }\n\n  return new Response('ok', { status: 200 })\n}\n","import { createClient } from '@supabase/supabase-js'\nimport { env } from '../env/server'\n\nexport const createAdminClient = () => {\n  if (!env.SUPABASE_SERVICE_ROLE_KEY) {\n    throw new Error('SUPABASE_SERVICE_ROLE_KEY is required for admin operations.')\n  }\n\n  return createClient(env.NEXT_PUBLIC_SUPABASE_URL, env.SUPABASE_SERVICE_ROLE_KEY)\n}\n"],"mappings":"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","names":["z","jsx","jsx","jsx","stripe","createClient","createClient"]}